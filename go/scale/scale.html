<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>scale</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="./images/icon.png">

<style>
/* FONT */
@font-face {
  font-family: "RuneScape UF";
  src: url("../../fonts/RuneScape-UF.woff2") format("woff2"),
       url("../../fonts/RuneScape-UF.woff") format("woff");
}

/* RESET */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: white;
  font-family: "RuneScape UF", Arial, sans-serif;

  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  cursor: url("../../images/cursor/cursor.png"), auto;
}

/* BACK BUTTON */
.back-button {
  position: fixed;
  top: 8px;
  left: 8px;
  font-size: 28px;
  background: transparent;
  border: none;
  color: #2d93ea;
  font-family: "RuneScape UF", Arial, sans-serif;
  cursor: url("../../images/cursor/cursor-hover.png"), pointer;
  text-transform: lowercase;
  padding: 0;
  z-index: 10;
}

/* SCALE WRAPPER */
.scale-wrapper {
  position: relative;
  z-index: 5;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
}

.weight {
  font-size: 72px;
  color: #2d93ea;
  margin-bottom: 20px;
}

.instruction {
  font-size: 22px;
  color: #2d93ea;
  margin-bottom: 12px;
}

/* GIF */
.gif-container {
  position: absolute;
  top: 60%;
  left: 50%;
  transform: translateX(-50%);
  display: none;
  z-index: 1;
}

.gif-container img {
  display: block;
  max-width: 150px;
  height: auto;
}
</style>
</head>

<body>

<button class="back-button" onclick="goBack()">‚Üê back</button>

<div class="scale-wrapper">
  <div class="weight" id="weight">0.0g</div>
  <div class="instruction">hold to weigh</div>
</div>

<div class="gif-container" id="gifContainer">
  <img src="scale.gif" alt="scale gif">
  <!-- Optional video fallback -->
  <!-- <video src="scale.mp4" autoplay loop muted playsinline></video> -->
</div>

<audio id="scaleSound" src="scale.mp3"></audio>

<script>
let currentWeight = 0;
let holding = false;
let settleTimer = 0;
let justHitOneGram = false;

const weightEl = document.getElementById("weight");
const gifContainer = document.getElementById("gifContainer");
const scaleSound = document.getElementById("scaleSound");

/* UPDATE DISPLAY WITH MICRO-JIGGLE */
function updateDisplay(jiggleX = 0, jiggleY = 0) {
  weightEl.textContent = currentWeight.toFixed(1) + "g";
  weightEl.style.transform = `translate(${jiggleX}px, ${jiggleY}px)`;
}

/* MAIN ANIMATION LOOP */
function animate() {
  let jiggleX = 0;
  let jiggleY = 0;

  if (holding) {
    // Smooth realistic climb to 1g
    const climbSpeed = 0.06;
    currentWeight += (1 - currentWeight) * climbSpeed;
    settleTimer++;

    if (currentWeight >= 0.99) {
      // Micro-jiggle around 1g
      if (Math.random() < 0.16) {
        currentWeight = 1 + (Math.random() - 0.5) * 0.06;
        jiggleX = (Math.random() - 0.5) * 3;
        jiggleY = (Math.random() - 0.5) * 1.5;
      } else {
        currentWeight += (1 - currentWeight) * 0.04;
      }

      // GIF appears under text
      if (gifContainer.style.display === "none") {
        gifContainer.style.display = "block";
      }

     // MP3 plays every time weight crosses ~1g upward
if (currentWeight >= 1 && !justHitOneGram) {
  scaleSound.currentTime = 0;
  scaleSound.play().catch(()=>{});
  justHitOneGram = true;
} 

// Reset once weight falls below ~0.95g
if (currentWeight < 0.95) {
  justHitOneGram = false;
}

    }

  } else {
    // Drop quickly on release
    currentWeight += (0 - currentWeight) * 0.15;
    settleTimer = 0;
    justHitOneGram = false;
    gifContainer.style.display = "none";
  }

  // Clamp weight
  if (currentWeight > 1.1) currentWeight = 1.1;
  if (!holding && currentWeight < 0.01) currentWeight = 0;

  updateDisplay(jiggleX, jiggleY);
  requestAnimationFrame(animate);
}

/* INPUT HANDLERS */
document.addEventListener("mousedown", () => holding = true);
document.addEventListener("mouseup", () => holding = false);
document.addEventListener("touchstart", () => holding = true, { passive: true });
document.addEventListener("touchend", () => holding = false, { passive: true });

/* NAVIGATION */
function goBack() {
  window.location.href = "../index.html";
}

/* START ANIMATION */
animate();
</script>

</body>
</html>
