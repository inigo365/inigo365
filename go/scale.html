<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>scale</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" type="image/png" href="../images/icon.png">

<style>
@font-face {
  font-family: "RuneScape UF";
  src: url("../fonts/RuneScape-UF.woff2") format("woff2"),
       url("../fonts/RuneScape-UF.woff") format("woff");
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: white;
  overflow: hidden;
  font-family: "RuneScape UF", Arial, sans-serif;
  cursor: url("../images/cursor/cursor.png"), auto;
}

.scale-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #2d93ea;
  text-align: center;
  user-select: none;
  position: relative;
}

.grams {
  font-size: 72px;
  margin-bottom: 24px;
}

.blurb {
  font-size: 20px;
  margin-bottom: 6px;
}

.sub-blurb {
  font-size: 14px;
  opacity: 0.9;
}

.back-button {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 28px;
  color: #2d93ea;
  background: transparent;
  border: none;
  cursor: url("../images/cursor/cursor-hover.png"), pointer;
  font-family: "RuneScape UF", Arial, sans-serif;
  z-index: 10;
}
</style>
</head>

<body>

<div class="scale-wrapper">
  <button class="back-button" id="backButton">&lt; back</button>
  <div class="grams" id="grams">0.0g</div>
  <div class="blurb">click on trackpad to weigh</div>
  <div class="sub-blurb">only works on macbook</div>
</div>

<script>
const gramsEl = document.getElementById("grams");
const backButton = document.getElementById("backButton");

backButton.onclick = () => {
  window.location.href = "/go"; // go back to password page
};

let value = 0;
let isTouching = false;

const TARGET = 1.0;       // max grams
const CLIMB_SPEED = 0.003; // slower climb
const DECAY_SPEED = 0.05;  // fast decay
const JITTER = 0.02;       // max +/- jitter

function updateTouch(evt) {
  isTouching = (evt.touches && evt.touches.length > 0) || (evt.buttons && evt.buttons > 0);
}

document.addEventListener("touchstart", updateTouch, { passive: true });
document.addEventListener("touchmove", updateTouch, { passive: true });
document.addEventListener("touchend", updateTouch, { passive: true });
document.addEventListener("mousedown", updateTouch);
document.addEventListener("mousemove", evt => {
  if (evt.buttons > 0) updateTouch(evt);
});
document.addEventListener("mouseup", updateTouch);

function animate() {
  if (isTouching) {
    if (value < TARGET) {
      value += CLIMB_SPEED;
      if (value > TARGET) value = TARGET;
    }
    // apply tiny random jitter while frozen at TARGET
    if (value >= TARGET) {
      value += (Math.random() * JITTER*2 - JITTER);
      if (value > TARGET) value = TARGET;
      if (value < 0) value = 0;
    }
  } else {
    if (value > 0) {
      value -= DECAY_SPEED;
      if (value < 0) value = 0;
    }
  }
  gramsEl.textContent = value.toFixed(1) + "g";
  requestAnimationFrame(animate);
}

animate();
</script>

</body>
</html>
