<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>scale</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" type="image/png" href="../images/icon.png">

<style>
@font-face {
  font-family: "RuneScape UF";
  src: url("../fonts/RuneScape-UF.woff2") format("woff2"),
       url("../fonts/RuneScape-UF.woff") format("woff");
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: white;
  overflow: hidden;
  font-family: "RuneScape UF", Arial, sans-serif;
  cursor: url("../images/cursor/cursor.png"), auto;
}

.scale-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #2d93ea;
  text-align: center;
  user-select: none;
}

.grams {
  font-size: 72px;
  margin-bottom: 24px;
}

.blurb {
  font-size: 20px;
  margin-bottom: 6px;
}

.sub-blurb {
  font-size: 14px;
  opacity: 0.9;
}
</style>
</head>

<body>

<div class="scale-wrapper">
  <div class="grams" id="grams">0.0g</div>
  <div class="blurb">place on trackpad to weigh</div>
  <div class="sub-blurb">this only works on macbook</div>
</div>

<script>
const gramsEl = document.getElementById("grams");

let value = 0;
let pressure = 0;
let pressing = false;
let lastInteraction = performance.now();
let lastFrame = performance.now();

/* === TUNING (REALISTIC) === */
const MOVE_SENSITIVITY = 0.001;
const PRESS_GAIN = 0.012;
const PRESSURE_DECAY = 0.92;
const VALUE_DECAY = 0.992;     // slow snap-back
const MAX_GRAMS = 3.5;
const FREEZE_TIME = 500;      // ms

/* Movement = micro force */
document.addEventListener("mousemove", e => {
  const movement = Math.abs(e.movementX) + Math.abs(e.movementY);
  if (movement > 0) {
    pressure += movement * MOVE_SENSITIVITY;
    lastInteraction = performance.now();
  }
});

/* Press & hold proxy */
document.addEventListener("mousedown", () => {
  pressing = true;
  lastInteraction = performance.now();
});

document.addEventListener("mouseup", () => {
  pressing = false;
  lastInteraction = performance.now();
});

/* Touch (trackpad taps) */
document.addEventListener("touchstart", () => {
  pressure += 0.04;
  lastInteraction = performance.now();
}, { passive: true });

function update() {
  const now = performance.now();
  const dt = (now - lastFrame) / 16;
  lastFrame = now;

  const inactive = now - lastInteraction > FREEZE_TIME;

  if (!inactive) {
    if (pressing) {
      pressure += PRESS_GAIN * dt;
    }

    value += pressure;
  }

  pressure *= PRESSURE_DECAY;
  value *= VALUE_DECAY;

  if (value < 0.02) value = 0;
  if (value > MAX_GRAMS) value = MAX_GRAMS;

  gramsEl.textContent = value.toFixed(1) + "g";

  requestAnimationFrame(update);
}

update();
</script>

</body>
</html>
