<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Boom! Flappy Basketball</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@font-face {
  font-family: "RuneScape UF";
  src: url("../../fonts/RuneScape-UF.woff2") format("woff2"),
       url("../../fonts/RuneScape-UF.woff") format("woff");
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: "RuneScape UF", Arial, sans-serif;
  cursor: url("../../images/cursor/cursor.png"), auto;
  background: #fff;
}

canvas {
  display: block;
  margin: 0 auto;
  background: #ffffff;
}

#startScreen {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  z-index: 10;
}

#startScreen p {
  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 36px;
  color: #2d93ea;
  cursor: url("../../images/cursor/cursor-hover.png"), pointer;
}

.score {
  position: absolute;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 36px;
  color: #2d93ea;
  z-index: 5;
}

.game-over {
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  display: none;
  z-index: 10;
  opacity: 0;
  transition: opacity 1s ease;
}

.game-over h1 {
  font-size: 48px;
  color: #2d93ea;
  margin-bottom: 20px;
}

.game-over p {
  font-size: 28px;
  color: #2d93ea;
  margin-bottom: 16px;
}

.game-over button {
  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 28px;
  padding: 8px 16px;
  cursor: url("../../images/cursor/cursor-hover.png"), pointer;
  background: #fff;
  border: 2px solid #2d93ea;
  color: #2d93ea;
}
</style>
</head>
<body>

<div id="startScreen"><p>Click or tap to start!</p></div>
<div class="score" id="score">0</div>

<div class="game-over" id="gameOver">
  <h1>Game Over</h1>
  <p id="finalScore"></p>
  <p id="highScore"></p>
  <button id="restartBtn">Restart</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Physics
const GRAVITY = 0.4;
const LIFT = -9;
const BALL_RADIUS = 30; // 1.5x
const HOOP_WIDTH = 100;
const HOOP_HEIGHT = 15;
const HOOP_GAP = 180;
const HOOP_SPEED = 2.0; // slower, smooth swing
const MAX_ROT = Math.PI / 3.6; // ~50 degrees

let ball = { x: 150, y: canvas.height/2, vy: 0, angle: 0, falling:false };
let hoops = [];
let score = 0;
let streak = 0;
let gameOver = false;
let gameStarted = false;

// Highscore
let highScore = localStorage.getItem('highScore') || 0;

// Sprites
let ballImg = new Image();
ballImg.src = "ball.png";
let hoopImg = new Image();
hoopImg.src = "hoop.png";

// Particles
let particles = [];

function addHoop() {
  const y = Math.random() * (canvas.height - HOOP_GAP - 150) + 75;
  hoops.push({ x: canvas.width, y: y, passed: false });
}

function addParticles(x, y) {
  for(let i=0;i<15;i++){
    particles.push({x:x, y:y, vx:(Math.random()-0.5)*4, vy:(Math.random()-0.5)*-4, alpha:1});
  }
}

function drawParticles() {
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    ctx.fillStyle = `rgba(45,147,234,${p.alpha})`;
    ctx.beginPath();
    ctx.arc(p.x,p.y,3,0,2*Math.PI);
    ctx.fill();
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.2;
    p.alpha -= 0.03;
    if(p.alpha <=0) particles.splice(i,1);
  }
}

// Click/tap input
function handleInput() {
  if(!gameStarted){
    gameStarted = true;
    document.getElementById('startScreen').style.display='none';
    loop();
  }
  if(!gameOver && !ball.falling) ball.vy = LIFT;
}

window.addEventListener('mousedown', handleInput);
window.addEventListener('touchstart', handleInput, {passive:true});

// Main loop
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(gameStarted){
    // Gravity
    if(!ball.falling) ball.vy += GRAVITY;
    ball.y += ball.vy;

    // Limit rotation
    ball.angle = Math.max(Math.min(ball.vy * 0.05, MAX_ROT), -MAX_ROT);

    // Ball hits floor if falling
    if(ball.falling && ball.y + BALL_RADIUS >= canvas.height){
      ball.y = canvas.height - BALL_RADIUS;
      ball.vy = 0;
      showGameOver();
    }

    // Draw ball rotated
    ctx.save();
    ctx.translate(ball.x, ball.y);
    ctx.rotate(ball.angle);
    ctx.drawImage(ballImg, -BALL_RADIUS, -BALL_RADIUS, BALL_RADIUS*2, BALL_RADIUS*2);
    ctx.restore();

    // Hoops
    for(let i=hoops.length-1;i>=0;i--){
      let h = hoops[i];
      h.x -= HOOP_SPEED;

      ctx.drawImage(hoopImg, h.x, h.y, HOOP_WIDTH, HOOP_HEIGHT);

      // Collision detection
      if(!h.passed && ball.x + BALL_RADIUS > h.x && ball.x - BALL_RADIUS < h.x + HOOP_WIDTH){
        const top = h.y;
        const bottom = h.y + HOOP_GAP;

        if(ball.y - BALL_RADIUS < top){ 
          // hit top rim
          ball.vy = 0.5; 
          ball.y = top - BALL_RADIUS;
        } else if(ball.y + BALL_RADIUS > bottom){
          // hit bottom rim
          ball.vy = 0.5;
          ball.y = bottom + BALL_RADIUS;
        } else {
          // Successful pass
          const hoopCenter = top + HOOP_GAP/2;
          const distance = Math.abs(ball.y - hoopCenter);
          if(distance < HOOP_GAP/4){
            streak++;
            score += 1 + streak;
            addParticles(ball.x, ball.y);
          } else {
            streak = 0;
            score += 1;
          }
          document.getElementById('score').textContent = score;
          h.passed = true;
        }
      }

      // End game if hoop passed without entering
      if(!h.passed && ball.x - BALL_RADIUS > h.x + HOOP_WIDTH){
        ball.falling = true;
        streak = 0;
      }

      // Remove offscreen hoops
      if(h.x + HOOP_WIDTH < 0) hoops.splice(i,1);
    }

    // Add new hoops
    if(hoops.length === 0 || hoops[hoops.length-1].x < canvas.width - 400) addHoop();

    // Draw particles
    drawParticles();
  }

  if(!gameOver) requestAnimationFrame(loop);
}

function showGameOver(){
  gameOver = true;
  if(score > highScore){
    highScore = score;
    localStorage.setItem('highScore', highScore);
  }
  const goEl = document.getElementById('gameOver');
  document.getElementById('finalScore').textContent = "Score: "+score;
  document.getElementById('highScore').textContent = "Highscore: "+highScore;
  goEl.style.display = 'block';
  goEl.style.opacity = 1;
}

// Restart
document.getElementById('restartBtn').addEventListener('click',()=>{
  ball = { x:150, y:canvas.height/2, vy:0, angle:0, falling:false };
  hoops = [];
  score = 0;
  streak = 0;
  gameOver = false;
  gameStarted = false;
  document.getElementById('gameOver').style.display='none';
  document.getElementById('score').textContent=score;
  document.getElementById('startScreen').style.display='flex';
});

// Resize
window.addEventListener('resize', ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>
</body>
</html>
