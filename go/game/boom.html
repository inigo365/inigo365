<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Boom! Flappy Basketball</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@font-face {
  font-family: "RuneScape UF";
  src: url("../../fonts/RuneScape-UF.woff2") format("woff2"),
       url("../../fonts/RuneScape-UF.woff") format("woff");
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: "RuneScape UF", Arial, sans-serif;
  cursor: url("../../images/cursor/cursor.png"), auto;
  background: #fff;
}

canvas {
  display: block;
  margin: 0 auto;
  background: #ffffff;
}

.score {
  position: absolute;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 36px;
  color: #2d93ea;
  z-index: 5;
}

.start-text {
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 36px;
  color: #2d93ea;
  text-align: center;
  z-index: 10;
}

.game-over {
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  display: none;
  z-index: 10;
}

.game-over h1 {
  font-size: 48px;
  color: #2d93ea;
  margin-bottom: 20px;
}

.game-over button {
  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 28px;
  padding: 8px 16px;
  cursor: url("../../images/cursor/cursor-hover.png"), pointer;
  background: #fff;
  border: 2px solid #2d93ea;
  color: #2d93ea;
}

.point-popup {
  position: absolute;
  font-size: 28px;
  color: #2d93ea;
  font-family: "RuneScape UF", Arial, sans-serif;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s, transform 0.3s;
  z-index: 6;
}
</style>
</head>

<body>

<div class="score" id="score">0</div>
<div class="start-text" id="startText">Click or Tap to Start</div>

<div class="game-over" id="gameOver">
  <h1>Game Over</h1>
  <p id="finalScore"></p>
  <p id="highScoreDisplay"></p>
  <button id="restartBtn">Restart</button>
</div>

<canvas id="gameCanvas"></canvas>
<div class="point-popup" id="pointPopup">+1</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Physics
const GRAVITY = 0.5;
const LIFT = -10;
const BALL_SCALE = 1.4;
const BALL_RADIUS = 20 * BALL_SCALE;
const HOOP_WIDTH = 200;
const HOOP_HEIGHT = 80;
const HOOP_GAP = 180;
const HOOP_SPEED = 5;

// Ball
let ball = { x: 150, y: canvas.height/2, vy: 0, rotation: 0 };
let hoops = [];
let score = 0;
let streak = 0;
let gameOver = false;
let gameStarted = false;

// Sprites
let ballImg = new Image();
ballImg.src = "ball.png";

let hoopImg = new Image();
hoopImg.src = "hoop.png";

// Point popup
const pointPopup = document.getElementById('pointPopup');
function showPopup(text, x, y){
  pointPopup.textContent = text;
  pointPopup.style.left = x + 'px';
  pointPopup.style.top = y + 'px';
  pointPopup.style.opacity = 1;
  pointPopup.style.transform = "translateY(-30px)";
  setTimeout(() => {
    pointPopup.style.opacity = 0;
    pointPopup.style.transform = "translateY(-50px)";
  }, 500);
}

// Add hoop
function addHoop(){
  const minY = HOOP_HEIGHT + 50;
  const maxY = canvas.height - HOOP_HEIGHT - HOOP_GAP - 50;
  const y = Math.random() * (maxY - minY) + minY;
  hoops.push({ x: canvas.width, y: y, passed: false });
}

// Click/tap to start
function startGame(){
  if(!gameStarted){
    gameStarted = true;
    document.getElementById('startText').style.display='none';
    hoops = [];
    score = 0;
    streak = 0;
    gameOver = false;
    ball.y = canvas.height/2;
    ball.vy = 0;
    document.getElementById('score').textContent = score;
    addHoop();
    loop();
  }
}
window.addEventListener('mousedown', startGame);
window.addEventListener('touchstart', startGame, { passive: true });

// Jump
function jump(){
  if(gameStarted && !gameOver) ball.vy = LIFT;
}
window.addEventListener('mousedown', jump);
window.addEventListener('touchstart', jump, { passive: true });

// Loop
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Gravity
  ball.vy += GRAVITY;
  ball.y += ball.vy;

  // Ball rotation
  ball.rotation = Math.max(Math.min(ball.vy*5,50),-50);

  // Ball boundaries (top/bottom)
  if(ball.y - BALL_RADIUS < 0 || ball.y + BALL_RADIUS > canvas.height){
    endGame();
  }

  // Draw ball
  ctx.save();
  ctx.translate(ball.x, ball.y);
  ctx.rotate(ball.rotation*Math.PI/180);
  ctx.drawImage(ballImg, -BALL_RADIUS, -BALL_RADIUS, BALL_RADIUS*2, BALL_RADIUS*2);
  ctx.restore();

  // Move hoops
  for(let i=hoops.length-1;i>=0;i--){
    hoops[i].x -= HOOP_SPEED;

    // Draw hoop once
    ctx.drawImage(hoopImg, hoops[i].x, hoops[i].y, HOOP_WIDTH, HOOP_HEIGHT);

    // Scoring rectangle
    const hoopLeft = hoops[i].x + 11;
    const hoopRight = hoops[i].x + HOOP_WIDTH - 11;
    const hoopTop = hoops[i].y;
    const hoopBottom = hoops[i].y + HOOP_HEIGHT - 16;

    // Scoring
    if(!hoops[i].passed &&
       ball.x > hoopLeft && ball.x < hoopRight &&
       ball.y - BALL_RADIUS < hoopBottom && ball.y + BALL_RADIUS > hoopTop){

      const ballCenter = ball.y;
      const hoopCenter = hoopTop + (HOOP_HEIGHT-16)/2;
      const distance = Math.abs(ballCenter - hoopCenter);
      let points = 1;
      if(distance < (HOOP_HEIGHT-16)/4){
        streak++;
        points += streak;
        showPopup('+'+points, ball.x, ball.y-50);
      } else {
        streak = 0;
        showPopup('+1', ball.x, ball.y-50);
      }

      score += points;
      hoops[i].passed = true;
      document.getElementById('score').textContent = score;
    }

    // Missed hoop ends game
    if(!hoops[i].passed && hoops[i].x + HOOP_WIDTH < ball.x - BALL_RADIUS){
      endGame();
    }

    // Remove hoops off screen
    if(hoops[i].x + HOOP_WIDTH < 0) hoops.splice(i,1);
  }

  // Add new hoop at regular interval
  if(hoops.length===0 || hoops[hoops.length-1].x < canvas.width - 500){
    addHoop();
  }

  if(!gameOver) requestAnimationFrame(loop);
}

// End game
function endGame(){
  gameOver = true;
  let groundY = canvas.height - BALL_RADIUS;
  function fall(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(ball.y < groundY){
      ball.vy += GRAVITY;
      ball.y += ball.vy;
    } else ball.y = groundY;
    ctx.drawImage(ballImg, ball.x - BALL_RADIUS, ball.y - BALL_RADIUS, BALL_RADIUS*2, BALL_RADIUS*2);
    if(ball.y < groundY) requestAnimationFrame(fall);
    else showGameOver();
  }
  fall();
}

function showGameOver(){
  document.getElementById('finalScore').textContent = "Score: "+score;
  let highScore = localStorage.getItem('flappyBasketHighscore') || 0;
  if(score > highScore){
    highScore = score;
    localStorage.setItem('flappyBasketHighscore', highScore);
  }
  document.getElementById('highScoreDisplay').textContent = "Highscore: "+highScore;
  document.getElementById('gameOver').style.display='block';
}

// Restart
document.getElementById('restartBtn').addEventListener('click',()=>{
  gameOver = false;
  gameStarted = false;
  hoops = [];
  ball = { x:150, y:canvas.height/2, vy:0, rotation:0 };
  document.getElementById('gameOver').style.display='none';
  document.getElementById('score').textContent=0;
  document.getElementById('startText').style.display='block';
});

// Resize
window.addEventListener('resize',()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

</script>

</body>
</html>
