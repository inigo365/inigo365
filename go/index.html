<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>inigo365</title>

<!-- iOS: stop zoom/double-tap zoom -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<link rel="icon" type="image/png" href="../images/icon.png">
<link rel="preload" href="../fonts/RuneScape-UF.woff2" as="font" type="font/woff2" crossorigin>
<link rel="apple-touch-icon" sizes="180x180" href="images/icon180.png">
<link rel="icon" type="image/png" sizes="192x192" href="images/icon192.png">
<link rel="icon" type="image/png" sizes="512x512" href="images/icon512.png">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="inigo365">
<meta name="apple-mobile-web-app-status-bar-style" content="default">


<style>
@font-face {
  font-family: "RuneScape UF";
  src: url("../fonts/RuneScape-UF.woff2") format("woff2"),
       url("../fonts/RuneScape-UF.woff") format("woff");
  font-display: swap;
}


/* Force white everywhere (helps iOS "grey" behind bounce) */
html { background: white; height: 100%; }
body { background: white; min-height: 100%; }

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  margin: 0;
  overflow: hidden;          /* no scrollbars */
  overscroll-behavior: none;

  font-family: "RuneScape UF", Arial, sans-serif;

  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  touch-action: manipulation;
  -webkit-text-size-adjust: 100%;
}

html, body { cursor: url("../images/cursor/cursor.png"), auto; }
button, input { cursor: url("../images/cursor/cursor-hover.png"), pointer; }
/* never allow sideways scroll/pan */
html, body {
  overflow-x: hidden;
  max-width: 100%;
}

*, *::before, *::after {
  box-sizing: border-box;
}

/* safety: any child cannot exceed viewport width */
.password-screen, .password-row, .password-box, #passwordForm {
  max-width: 100%;
}

button {
  -webkit-appearance: none;
  appearance: none;
  color: inherit;
}

:root{
  --accent: #2d93ea;  /* blue for nav/play/back */
  --btn: #000000;     /* black for UI buttons */
}
/* input + always-visible help button (does NOT affect centering) */
.input-wrap {
  position: relative;
  display: inline-block; /* keeps same centering behavior as before */
}

.help-side {
  position: absolute;
  left: calc(100% + 12px); /* sits to the right of the input */
  top: 50%;
  transform: translateY(-50%);
  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 24px;
  padding: 0;
  border: 0;
  background: transparent;
  color: var(--btn);
  line-height: 1;
  cursor: url("../images/cursor/cursor-hover.png"), pointer;
  z-index: 5;
}
.help-side:hover { text-decoration: underline; }

.password-screen{
  width: 100%;
  min-height: 100vh;
  background: transparent;
  transition: opacity 0.4s ease;
  position: relative;

  display: flex;
  justify-content: center;

  /* DESKTOP DEFAULT: vertically centered like your photoshop */
  align-items: center;

  padding: 24px 16px 110px;
  box-sizing: border-box;
  overflow-y: auto;
}

/* If screen is small, top-align so it feels like an app and doesn't look cramped */
@media (max-width: 768px){
  .password-screen{
    align-items: flex-start;
    padding-top: 44px;
  }
}

/* optional iOS safe area */
@supports (padding: max(0px)) {
  .password-screen {
    padding-top: max(24px, calc(16px + env(safe-area-inset-top)));
    padding-bottom: max(110px, calc(90px + env(safe-area-inset-bottom)));
  }
  @media (max-width: 768px){
    .password-screen{
      padding-top: max(44px, calc(16px + env(safe-area-inset-top)));
    }
  }
}

/* row becomes just a centered container */
.password-row {
  width: 100%;
  display: flex;
  justify-content: center;
}

/* single centered column with a max width */
.password-box {
  width: min(980px, 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;

  gap: 14px; /* consistent vertical rhythm */
}

.password-box input {
  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 24px;
  padding: 8px 12px;
  border: 2px solid black;
  background: white;
  outline: none;
  text-align: center;

  border-radius: 0;
  -webkit-appearance: none;
  appearance: none;
}

/* fixed slot so nothing shifts */
.action-row {
  width: 140px;
  height: 28px;
  line-height: 28px;
  text-align: center;
  position: relative;
}

/* ===== SMOOTH SWITCHING BASE ===== */
.switch-btn {
  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 24px;

  width: 140px;
  height: 28px;
  line-height: 28px;
  text-align: center;

  padding: 0;
  border: 0;
  background: transparent;
  text-transform: lowercase;
  color: var(--btn);

  position: absolute;
  inset: 0;

  /* smoother on iOS */
  will-change: opacity, transform;
  transform: translate3d(0, 2px, 0);
  opacity: 0;
  pointer-events: none;

  transition:
    opacity 120ms ease,
    transform 180ms cubic-bezier(.2,.9,.2,1);
}

.switch-btn.show {
  opacity: 1;
  pointer-events: auto;
  transform: translate3d(0, 0, 0);
}

.switch-btn:hover { text-decoration: underline; }
/* help button that lives in the action-row slot */
.help-under { z-index: 1; }

/* ENTER button (ONLY submits, never opens cheats) */
.enter-button { z-index: 2; }

/* Crisp "nope" flash */
.enter-button.flash {
  opacity: 1;
  transform: translate3d(0, 0, 0);
  animation: nopePulse 260ms ease both;
}

@keyframes nopePulse {
  0%   { opacity: 1; }
  45%  { opacity: .22; }
  100% { opacity: 1; }
}

/* ===== add to home page button (mobile only) ===== */
.add-home-btn {
  display: none; /* default hidden */
  position: fixed;
  left: 50%;
  bottom: 14px;
  transform: translateX(-50%);
  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 18px;
  padding: 0;
  border: 0;
  background: transparent;
  color: var(--btn);
  text-transform: lowercase;
  z-index: 20;
}
.add-home-btn:hover { text-decoration: underline; }

@media (max-width: 768px) {
  .add-home-btn { display: block; }
}

/* ===== overlays ===== */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,0.65);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.panel {
  width: min(640px, calc(100vw - 24px));
  border: 2px solid black;
  padding: 16px;
  background: rgba(255,255,255,0.85);
  text-align: center;
  position: relative;
}

.panel-title {
  font-size: 30px;
  margin-bottom: 10px;
  text-transform: lowercase;
}

.panel-sub {
  font-size: 18px;
  margin-bottom: 12px;
}

/* footer row */
.panel-footer {
  margin-top: 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

.linkish {
  font-family: "RuneScape UF", Arial, sans-serif;
  background: transparent;
  border: none;
  color: var(--btn);
  font-size: 22px;
  padding: 0;
  text-transform: lowercase;
  cursor: url("../images/cursor/cursor-hover.png"), pointer;
}
.linkish:hover { text-decoration: underline; }

.footer-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* boxed buttons */
.boxbtn {
  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 20px;
  padding: 8px 14px;
  border: 2px solid black;
  background: white;
  text-transform: lowercase;
  color: var(--btn);
  cursor: url("../images/cursor/cursor-hover.png"), pointer;
}

/* cheat entry UI */
.cheat-seq {
  font-size: 18px;
  border: 2px solid black;
  padding: 10px;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  flex-wrap: wrap;
}

.cheat-grid {
  margin-top: 12px;
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 10px;
  justify-items: center;
}

.cheat-btn {
  width: 100%;
  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 22px;
  padding: 10px 0;
  border: 2px solid black;
  background: white;
  text-transform: lowercase;
  color: var(--btn);
}

.cheat-actions {
  margin-top: 12px;
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}

/* centered "?" info button under submit row */
.cheat-info-wrap {
  margin-top: 10px;
  display: flex;
  justify-content: center;
}

.cheat-info-q {
  font-family: "RuneScape UF", Arial, sans-serif;
  background: transparent;
  border: none;
  color: var(--btn);
  font-size: 24px;
  padding: 0;
  line-height: 1;
  cursor: url("../images/cursor/cursor-hover.png"), pointer;
}
.cheat-info-q:hover { text-decoration: underline; }

/* unlocked feedback */
.unlock-flash {
  font-size: 20px;
  margin-top: 10px;
  min-height: 22px;
  opacity: 0;
  transition: opacity 0.15s ease;
  text-transform: lowercase;
  color: var(--btn);
}
.unlock-flash.show { opacity: 1; }

/* vault list spaced evenly */
.vault-list {
  border: 2px solid black;
  padding: 18px 14px;
  min-height: 96px;
  display: flex;
  align-items: center;
  justify-content: space-evenly;
  font-size: 28px;
  text-transform: lowercase;
  gap: 28px;
}

/* clickable vault items */
.vault-item {
  padding: 0;
  border: 0;
  background: transparent;
  font: inherit;
  color: var(--btn);
  text-transform: lowercase;
}
button.vault-item:hover { text-decoration: underline; }

/* MINI POPUP */
.mini-overlay {
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.mini-panel {
  width: min(520px, calc(100vw - 24px));
  border: 2px solid black;
  padding: 14px;
  background: white;
  text-align: center;
}

.mini-title {
  font-size: 26px;
  margin-bottom: 8px;
  text-transform: lowercase;
}

.mini-body {
  font-size: 18px;
  line-height: 1.35;
  text-transform: lowercase;
  margin-bottom: 12px;
}

.mini-body .code-line {
  display: block;
  margin: 6px 0;
}

/* Add-to-home panel visuals */
.home-steps {
  font-size: 18px;
  text-transform: lowercase;
  line-height: 1.4;
}
.home-step {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin: 8px 0;
  flex-wrap: wrap;
}
.share-icon {
  width: 22px;
  height: 22px;
  display: inline-block;
  vertical-align: middle;
}

/* CONTENT PAGE */
.content-page {
  display: none;
  width: 100%;
  height: 100vh;
  height: 100svh;
  height: 100dvh;
  background: transparent;
}

.content-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

/* VIDEO */
.video-wrapper {
  position: relative;
  width: 100%;
  max-width: 854px;
  aspect-ratio: 854 / 480;
  background: transparent;
  opacity: 0;
  transition: opacity 1s ease;
  display: none;
}

video {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

@media (min-width: 1200px) {
  .video-wrapper { max-width: 1000px; }
}

/* MOBILE SCALE OVERRIDE */
@media (max-width: 768px) {
  .video-wrapper.mobile-fill {
    width: 100vw;
    max-width: none;
    height: calc(100vh - 56px);
    aspect-ratio: auto;
  }
}

/* PLAY BUTTON */
.play-button {
  position: absolute;
  top: 43%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 52px;
  color: var(--accent);
  background: transparent;
  border: none;
  text-transform: lowercase;
  opacity: 0;
  transition: opacity 0.4s ease;
  z-index: 10;
  font-family: "RuneScape UF", Arial, sans-serif;
  pointer-events: none;
}

.play-button.show {
  opacity: 1;
  pointer-events: auto;
}

/* BACK BUTTON */
.back-button {
  position: fixed;
  top: 8px;
  left: 8px;
  font-size: 28px;
  background: transparent;
  border: none;
  color: var(--accent);
  font-family: "RuneScape UF", Arial, sans-serif;
  text-transform: lowercase;
  padding: 0;
  z-index: 10;
}

.back-button.show {
  opacity: 1;
}

.portal-dock{
  width: 100%;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 14px;
}

@media (max-width: 520px){
  .portal-dock{ grid-template-columns: 1fr; }
}

.portal-tile{
  border: 2px solid black;
  background: white;
  padding: 16px 14px;
  min-height: 76px;

  text-transform: lowercase;
  font-family: "RuneScape UF", Arial, sans-serif;
  color: var(--btn);

  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
}


.portal-tile:hover{ text-decoration: underline; }

.portal-left{
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.portal-title{
  font-size: 24px;
  line-height: 1;
}

.portal-sub{
  font-size: 16px;
  opacity: 0.85;
  line-height: 1.1;
}

.portal-right{
  font-size: 22px;
  opacity: 0.9;
}

.portal-hint{
  width: 100%;
  margin-top: 2px;
  margin-bottom: 6px;
  font-size: 18px;
  text-transform: lowercase;
  opacity: 0.9;
}

/* give the label a bit of separation from tiles */
.password-box label{
  margin-top: 6px;
  margin-bottom: 6px;
}
/* =========================
   BACKGROUND IMAGE
   Put the file at: images/background.jpg
   ========================= */
html, body { background: transparent; }

body{
  background-image: url("images/background.png");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
}

@media (max-width: 768px){
  body{ background-attachment: scroll; }
}

/* =========================
   TRANSLUCENT UI SURFACES
   ========================= */
.portal-tile,
#passwordInput,
.panel,
.boxbtn,
.cheat-seq,
.vault-list,
.mini-panel{
  background: rgba(255,255,255,0.74);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

/* Keep borders crisp */
.portal-tile,
#passwordInput,
.panel,
.boxbtn,
.cheat-seq,
.vault-list,
.mini-panel{
  border-color: #000;
}

/* =========================
   TILES: ALWAYS LEFT ALIGN TEXT
   ========================= */
.portal-left{
  align-items: flex-start;
  text-align: left;
  width: 100%;
}
.portal-title,
.portal-sub{
  width: 100%;
  text-align: left;
}

/* =========================
   TILES LAYOUT:
   Desktop = 3 fixed columns like your mock
   Mobile  = stacked
   ========================= */
.portal-dock{
  width: min(980px, 100%);
  display: grid;
  gap: 14px;
}

@media (min-width: 769px){
  .portal-dock{
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 768px){
  .portal-dock{
    grid-template-columns: 1fr;
  }
}

/* =========================
   PASSWORD + INPUT + ENTER LAYOUT
   (matches your Photoshop mocks)
   ========================= */

/* Stop the whole box forcing center text (we’ll control it locally) */
.password-box{
  text-align: initial;
}

/* DESKTOP: hard-lock placement */
#passwordForm{
  width: 100%;
  display: grid;
  align-items: center;
  column-gap: 18px;
  row-gap: 10px;

  grid-template-columns: max-content minmax(0, 520px) 140px;
  grid-template-areas:
    "label input action"
    "hint  hint  hint";

  justify-content: center;
}

#passwordForm label { grid-area: label; }
#passwordInput      { grid-area: input;  min-width: 0; }
.action-row         { grid-area: action; justify-self: end; }
#passwordForm .hint-row {
  grid-area: hint;
  width: 100%;          /* IMPORTANT: don't give it a competing fixed width */
  margin-top: 14px;
  display: flex;
  justify-content: center;
}

/* label */
#passwordForm label{
  margin: 0;
  font-size: 32px;
  text-transform: lowercase;
  text-align: right;
  white-space: nowrap;
}


/* input fills its grid column */
#passwordInput{
  width: 100%;
  min-width: 0;
  max-width: 520px;
  text-align: center;
}

/* action sits to the right on desktop */
.action-row{
  width: 140px;
  height: 28px;
  line-height: 28px;
  text-align: center;
  position: relative;
  justify-self: end;
}

/* HINT ROW */
.hint-row{
  width: min(980px, 100%);
  display: grid;
  align-items: center;
  margin-top: 14px;

  /* desktop: center tip, ? pinned right but INSIDE the 980px box */
  grid-template-columns: 1fr auto 1fr;
}

.portal-hint{
  grid-column: 2;
  margin: 0;
  text-align: center;
}

/* right-side ? */
.hint-help{
  grid-column: 3;
  justify-self: end;

  font-family: "RuneScape UF", Arial, sans-serif;
  font-size: 24px;
  padding: 0;
  border: 0;
  background: transparent;
  color: var(--btn);
  line-height: 1;

  opacity: 0;
  pointer-events: none;
}
.hint-help.show{
  opacity: 1;
  pointer-events: auto;
}
.hint-help:hover{ text-decoration: underline; }
/* =========================
   MOBILE — NEAT + NEVER OVERFLOW
   ========================= */
@media (max-width: 768px){

  .password-screen{
    align-items: flex-start;
    padding-top: 44px;
  }

  .password-box{
    width: 100%;
    align-items: stretch;
    text-align: left;
  }

  .portal-dock{
    width: 100%;
    max-width: 680px;
    margin: 0 auto;
    grid-template-columns: 1fr;
  }

  /* 2x2 grid:
     row1: label | input
     row2: hint  | action
  */
  #passwordForm{
    width: 100%;
    max-width: 680px;
    margin: 0 auto;

    display: grid;
    grid-template-columns: max-content 1fr;
    grid-template-areas:
      "label input"
      "hint  action";

    column-gap: 8px;
    row-gap: 10px;

    justify-content: stretch;
    align-items: center;
  }
   #passwordForm .hint-row{
    grid-area: hint;
    margin: 0;
    display: block;
  }

  #passwordForm .portal-hint{
    text-align: left;
    white-space: nowrap;       /* keep it one line so height never changes */
    overflow: hidden;
    text-overflow: ellipsis;
    min-height: 1.2em;         /* stable height */
  }

  /* smaller label = same feel as portal tile headings */
  #passwordForm label{
    grid-area: label;

    font-size: 24px;         /* match .portal-title */
    line-height: 1;
    text-align: left;

    white-space: normal;     /* allow wrap */
    max-width: 9ch;          /* forces "enter" + "password:" stack neatly */
    margin: 0;
  }

  /* input MUST NEVER exceed viewport */
  #passwordInput{
    grid-area: input;
    

    width: 100%;
    max-width: 100%;
    min-width: 0;            /* IMPORTANT for grid overflow */
    box-sizing: border-box;  /* IMPORTANT for overflow */

    font-size: 24px;
    padding: 12px 12px;
    text-align: center;
  }

  /* hint sits directly under, left side */
  .hint-row{
    grid-area: hint;
    margin: 0;
    align-self: center;
  }

  .portal-hint{
    margin: 0;
    text-align: left;
    font-size: 18px;
  }

  /* action sits directly under, right side */
  .action-row{
    grid-area: action;
    transform: translate3d(22px, 6px, 0);

    justify-self: end;
    margin: 0;

    width: 140px;
    height: 28px;
    line-height: 28px;
  }
}
/* Hint row is INSIDE the form now — desktop: centered */
#passwordForm .hint-row{
  grid-column: 1 / -1;        /* span all columns on desktop */
  margin-top: 14px;
  display: flex;
  justify-content: center;     /* center the hint row */
}

/* desktop hint: centered */
#passwordForm .portal-hint{
  text-align: center;
  line-height: 1.2;
  min-height: 1.2em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

/* mobile override: keep it left */
@media (max-width: 768px){
  #passwordForm .hint-row{
    justify-content: flex-start; /* left-align the row */
  }
  #passwordForm .portal-hint{
    text-align: left;
  }
}


</style>
</head>

<body>

<div class="password-screen" id="passwordScreen">
  <div class="password-row">
    <div class="password-box">

      <div class="portal-dock" id="portalDock" aria-label="quick portal links"></div>

      <!-- PASSWORD + INPUT + ENTER -->
      <form id="passwordForm" autocomplete="off">
        <label for="passwordInput">enter password:</label>

        <input
          type="password"
          id="passwordInput"
          autocomplete="off"
          autocapitalize="none"
          autocorrect="off"
          spellcheck="false"
          enterkeyhint="go"
        >

        <div class="action-row">
          <button type="submit" class="switch-btn enter-button" id="enterButton" aria-label="enter">enter ↵</button>
          <button type="button" class="switch-btn help-under" id="hintHelp" aria-label="help">?</button>
        </div>
         <div class="hint-row">
    <div class="portal-hint" id="portalHint">hint: ? opens the code console</div>
  </div>
      </form>

    </div>
  </div>

  <button class="add-home-btn" id="addHomeBtn" type="button">add to home page</button>
</div>

<!-- CHEAT ENTRY OVERLAY -->
<div class="overlay" id="cheatOverlay" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true" aria-label="enter code">
    <div class="panel-title">enter code:</div>
    <div class="panel-sub">tap buttons or use keyboard: arrows + a + b</div>

    <div class="cheat-seq" id="cheatSequence"></div>

    <div class="cheat-grid">
      <div></div>
      <button class="cheat-btn" data-token="U" type="button">↑</button>
      <div></div>

      <button class="cheat-btn" data-token="L" type="button">←</button>
      <button class="cheat-btn" data-token="D" type="button">↓</button>
      <button class="cheat-btn" data-token="R" type="button">→</button>

      <button class="cheat-btn" data-token="A" type="button">a</button>
      <button class="cheat-btn" data-token="B" type="button">b</button>
      <div></div>
    </div>

    <div class="cheat-actions">
      <button class="boxbtn" id="cheatClear" type="button">clear</button>
      <button class="boxbtn" id="cheatSubmit" type="button">submit</button>
    </div>

    <div class="unlock-flash" id="unlockFlash"></div>

    <div class="cheat-info-wrap">
      <button class="cheat-info-q" id="cheatInfo" type="button">cheatcodes</button>
    </div>

    <div class="panel-footer">
      <button class="linkish" id="cheatToVault" type="button">code vault</button>
      <div class="footer-right">
        <button class="linkish" id="cheatClose" type="button">close</button>
      </div>
    </div>
  </div>
</div>

<!-- VAULT OVERLAY -->
<div class="overlay" id="vaultOverlay" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true" aria-label="code vault">
    <div class="panel-title">code vault</div>
    <div class="panel-sub" id="vaultSub">unlocked passcodes appear here</div>

    <div class="vault-list" id="vaultList">—</div>

    <div class="panel-footer">
      <button class="linkish" id="vaultBack" type="button">back</button>
      <div class="footer-right">
        <button class="linkish" id="vaultClose" type="button">close</button>
      </div>
    </div>
  </div>
</div>

<!-- MINI POPUP -->
<div class="mini-overlay" id="miniOverlay" aria-hidden="true">
  <div class="mini-panel" role="dialog" aria-modal="true" aria-label="cheatcodes list">
    <div class="mini-title">cheatcodes</div>
    <div class="mini-body" id="miniBody">
      <span class="code-line">↑ ↑ ↓ ↓ ← → ← → b a</span>
      <span class="code-line">↑ ↓ ↑ ↓ a b</span>
      <span class="code-line">a b a b</span>
    </div>
    <button class="linkish" id="miniClose" type="button">close</button>
  </div>
</div>

<!-- Add-to-Home instructions overlay -->
<div class="overlay" id="homeOverlay" aria-hidden="true">
  <div class="panel" role="dialog" aria-modal="true" aria-label="add to home page">
    <div class="panel-title">add to home page</div>
    <div class="panel-sub" id="homeHow"></div>

    <div class="home-steps" id="homeSteps"></div>

    <div class="panel-footer">
      <div></div>
      <div class="footer-right">
        <button class="linkish" id="homeClose" type="button">close</button>
      </div>
    </div>
  </div>
</div>

<div class="content-page" id="contentPage">
  <div class="content-wrapper">
    <button class="back-button" id="backButton">← back</button>

    <div class="video-wrapper" id="videoWrapper">
      <video id="videoElement" playsinline disablePictureInPicture controlsList="nodownload nofullscreen noremoteplayback"></video>
    </div>

    <button class="play-button" id="playButton">play</button>
  </div>
</div>

<script>
/* iOS: prevent pinch-zoom gesture glitches */
document.addEventListener("gesturestart", (e) => e.preventDefault(), { passive: false });
document.addEventListener("gesturechange", (e) => e.preventDefault(), { passive: false });
document.addEventListener("gestureend", (e) => e.preventDefault(), { passive: false });

const passwordInput = document.getElementById("passwordInput");
const passwordForm = document.getElementById("passwordForm");
const enterButton = document.getElementById("enterButton");
const hintHelp = document.getElementById("hintHelp");
const passwordScreen = document.getElementById("passwordScreen");
const contentPage = document.getElementById("contentPage");
const playButton = document.getElementById("playButton");
const videoWrapper = document.getElementById("videoWrapper");
const video = document.getElementById("videoElement");
const backButton = document.getElementById("backButton");
const cheatOverlay = document.getElementById("cheatOverlay");
const cheatSequenceEl = document.getElementById("cheatSequence");
const cheatClear = document.getElementById("cheatClear");
const cheatSubmit = document.getElementById("cheatSubmit");
const cheatToVault = document.getElementById("cheatToVault");
const cheatClose = document.getElementById("cheatClose");
const cheatInfo = document.getElementById("cheatInfo");
const unlockFlash = document.getElementById("unlockFlash");

const vaultOverlay = document.getElementById("vaultOverlay");
const vaultList = document.getElementById("vaultList");
const vaultSub = document.getElementById("vaultSub");
const vaultBack = document.getElementById("vaultBack");
const vaultClose = document.getElementById("vaultClose");

const miniOverlay = document.getElementById("miniOverlay");
const miniClose = document.getElementById("miniClose");

/* add to home */
const addHomeBtn = document.getElementById("addHomeBtn");
const homeOverlay = document.getElementById("homeOverlay");
const homeClose = document.getElementById("homeClose");
const homeHow = document.getElementById("homeHow");
const homeSteps = document.getElementById("homeSteps");

/* ===========================
   SFX (more iOS-proof + lower latency)
   - WebAudio when possible
   - pooled <audio> fallback (important for iOS latency)
   - primes/unlocks on first gesture
=========================== */
const SFX = (() => {
  const paths = {
    click:   "sounds/click.mp3",
    password:"sounds/password.mp3",
    correct: "sounds/correct.mp3"
  };

  const volumes = { click: 0.55, password: 0.75, correct: 0.75 };

  let ctx = null;
  let master = null;
  let unlocked = false;

  const fetched = new Map();   // name -> ArrayBuffer
  const buffers = new Map();   // name -> AudioBuffer

  // pooled HTMLAudio (reduces "clunky" / delayed feeling on iOS)
  const pools = new Map();     // name -> { els: HTMLAudioElement[], i: number }
  const POOL_SIZES = { click: 8, password: 3, correct: 3 };

  function ensurePool(name) {
    if (pools.has(name)) return pools.get(name);

    const n = POOL_SIZES[name] ?? 3;
    const els = Array.from({ length: n }, () => {
      const a = new Audio(paths[name]);
      a.preload = "auto";
      a.volume = volumes[name] ?? 1;
      return a;
    });

    const obj = { els, i: 0 };
    pools.set(name, obj);
    return obj;
  }

  function playFromPool(name) {
    const pool = ensurePool(name);
    const a = pool.els[pool.i];
    pool.i = (pool.i + 1) % pool.els.length;

    try {
      // restart fast
      a.pause();
      a.currentTime = 0;
      const p = a.play();
      if (p && typeof p.catch === "function") p.catch(() => {});
    } catch {}
  }

  async function fetchAll() {
    await Promise.all(Object.keys(paths).map(async (name) => {
      try {
        const res = await fetch(paths[name], { cache: "force-cache" });
        const arr = await res.arrayBuffer();
        fetched.set(name, arr);
      } catch {
        // fallback pool still exists
        ensurePool(name);
      }
    }));
  }

  function ensureContext() {
    if (ctx) return ctx;
    const AC = window.AudioContext || window.webkitAudioContext;
    if (!AC) return null;
    ctx = new AC();
    master = ctx.createGain();
    master.gain.value = 1;
    master.connect(ctx.destination);
    return ctx;
  }

  async function decodeAllIfPossible() {
    if (!ctx) return;

    if (ctx.state === "suspended") {
      try { await ctx.resume(); } catch {}
    }

    for (const name of Object.keys(paths)) {
      if (buffers.has(name)) continue;
      const arr = fetched.get(name);
      if (!arr) continue;

      try {
        const buf = await ctx.decodeAudioData(arr.slice(0));
        buffers.set(name, buf);
      } catch {
        ensurePool(name);
      }
    }
  }

  // call inside a user gesture
  async function unlockNow() {
    if (unlocked) return;
    unlocked = true;

    ensureContext();
    for (const n of Object.keys(paths)) ensurePool(n);

    await decodeAllIfPossible();

    // iOS warm-up blip
    if (ctx && master && ctx.state === "running") {
      try {
        const osc = ctx.createOscillator();
        const g = ctx.createGain();
        g.gain.value = 0.0001;
        osc.connect(g);
        g.connect(master);
        osc.start();
        osc.stop(ctx.currentTime + 0.01);
      } catch {}
    }
  }

  function playWebAudio(name) {
    if (!ctx || !master) return false;
    const buf = buffers.get(name);
    if (!buf) return false;

    try {
      const src = ctx.createBufferSource();
      src.buffer = buf;
      const g = ctx.createGain();
      g.gain.value = volumes[name] ?? 1;
      src.connect(g);
      g.connect(master);
      src.start(0);
      return true;
    } catch {
      return false;
    }
  }

  function play(name) {
    // WebAudio if ready, else pooled <audio> (fast on iOS)
    const ok = playWebAudio(name);
    if (!ok) playFromPool(name);
  }

  // start fetching early
  fetchAll();

  const primeHandler = () => { unlockNow(); };
  window.addEventListener("touchstart", primeHandler, { capture: true, once: true });
  window.addEventListener("pointerdown", primeHandler, { capture: true, once: true });
  window.addEventListener("keydown", primeHandler, { capture: true, once: true });

  return { play, unlockNow };
})();

/* ===========================
   GLOBAL CLICK SFX (simple, no doubles)
   - plays on "main" buttons only
   - NOT on enterButton
   - NOT on cheat pad buttons (.cheat-btn)
=========================== */

(function setupClickSfx() {
  let lastAt = 0;

  function shouldPlayClick(btn) {
    if (!btn || btn.disabled) return false;

    // Exclude enter (special)
    if (btn.id === "enterButton") return false;

    // Exclude cheat-pad buttons (↑ ↓ ← → a b)
    if (btn.classList.contains("cheat-btn")) return false;

    return true;
  }

  function handler(e) {
    const btn = e.target.closest("button");
    if (!shouldPlayClick(btn)) return;

    // tiny debounce to prevent any double-fire edge cases
    const now = performance.now();
    if (now - lastAt < 120) return;
    lastAt = now;

    SFX.unlockNow();
    SFX.play("click");
  }

  // Use ONE fast event path (prevents double audio)
  if ("PointerEvent" in window) {
    document.addEventListener("pointerdown", handler, { capture: true });
  } else {
    document.addEventListener("touchstart", handler, { capture: true, passive: true });
  }
})();


document.addEventListener("keydown", (e) => {
  if (e.key !== "Enter" && e.key !== " ") return;
  const el = document.activeElement;
  if (!el || el.tagName !== "BUTTON") return;
  if (el.disabled) return;
  if (el.id === "enterButton") return;

  SFX.unlockNow();
  SFX.play("click");
}, true);


/* =========================== */


let currentAction = null;
let endedListener = null;

/**
 * Actions
 */
const actions = {
  "donovan": { src: "videos/video.mp4" },
  "gambosi": { src: "videos/skud.mp4" },
  "wasted":  { src: "videos/litty.mp4" },

  "tinny": { redirect: "scale/scale.html", sameTab: true },
  "bag":   { redirect: "game/boom.html", sameTab: true, useGate: false },
  "home":  { redirect: "../home.html", sameTab: true, useGate: false },
  "rick":  { redirect: "https://www.youtube.com/watch?v=dQw4w9WgXcQ", sameTab: false },
  "onway": { redirect: "stoneinfocus/stoneinfocus.html", sameTab: true },
  "deathstar": { redirect: "couchburnsimulator/couch.html", sameTab: true },

  "1millionfrogs": { redirect: "1millionfrogs/1millionfrogs.html", sameTab: true, useGate: false },
  "heavychest": { src: "videos/andre.mp4", mobileFill: true }
};
// ===== PUBLIC DOCK (always visible) =====
const PUBLIC_ACTIONS = [
  { key: "home",          title: "creative portfolio",sub: "main page",        glyph: "→" },
  { key: "bag",           title: "put the bag in the bag",sub: "game",             glyph: "→" },
  { key: "1millionfrogs", title: "1millionfrogs",sub: "game",             glyph: "→" }
];

const portalDock = document.getElementById("portalDock");
const portalHint = document.getElementById("portalHint");

function renderPortalDock() {
  if (!portalDock) return;
  portalDock.innerHTML = "";

  for (const item of PUBLIC_ACTIONS) {
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "portal-tile";
    btn.setAttribute("data-key", item.key);

    btn.innerHTML = `
      <div class="portal-left">
        <div class="portal-title">${item.title}</div>
        <div class="portal-sub">${item.sub}</div>
      </div>
      <div class="portal-right">${item.glyph}</div>
    `;

    btn.addEventListener("click", () => {
      SFX.unlockNow();
      runActionByKey(item.key);
    });

    portalDock.appendChild(btn);
  }
}

renderPortalDock();

/**
 * Cheat sequences -> unlocks.
 * Tokens: U D L R A B
 */
const cheatUnlocks = {
  "U U D D L R L R B A": ["heavychest"],
  "U D U D A B": ["wasted"],
  "A B A B": ["gambosi"]
};

// ===== unlock storage =====
const UNLOCK_KEY = "portal_unlocked_codes_v1";

function loadUnlockedSet() {
  try {
    const raw = localStorage.getItem(UNLOCK_KEY);
    const arr = raw ? JSON.parse(raw) : [];
    return new Set(Array.isArray(arr) ? arr : []);
  } catch {
    return new Set();
  }
}

function saveUnlockedSet(set) {
  try { localStorage.setItem(UNLOCK_KEY, JSON.stringify([...set])); } catch {}
}

let unlocked = loadUnlockedSet();

// ===== state for showing cheat access =====
let hasWrongAttempt = false;

// ===== overlays =====
function hideUnlockFlash() {
  unlockFlash.textContent = "";
  unlockFlash.classList.remove("show");
  clearTimeout(hideUnlockFlash._t);
}
function showUnlockFlash(text) {
  unlockFlash.textContent = text;
  unlockFlash.classList.add("show");
  clearTimeout(hideUnlockFlash._t);
  hideUnlockFlash._t = setTimeout(() => {
    unlockFlash.classList.remove("show");
  }, 1200);
}

function closeAllOverlays() {
  cheatOverlay.style.display = "none";
  cheatOverlay.setAttribute("aria-hidden", "true");

  vaultOverlay.style.display = "none";
  vaultOverlay.setAttribute("aria-hidden", "true");

  miniOverlay.style.display = "none";
  miniOverlay.setAttribute("aria-hidden", "true");

  homeOverlay.style.display = "none";
  homeOverlay.setAttribute("aria-hidden", "true");

  hideUnlockFlash();
  requestAnimationFrame(() => passwordInput.focus());
}

function openCheatOverlay() {
  // close keyboard on mobile
  try { passwordInput.blur(); } catch {}

  clearCheat();
  hideUnlockFlash();
  cheatOverlay.style.display = "flex";
  cheatOverlay.setAttribute("aria-hidden", "false");
}

function openVaultOverlay() {
  renderVault();
  vaultOverlay.style.display = "flex";
  vaultOverlay.setAttribute("aria-hidden", "false");
}

function openMini() {
  miniOverlay.style.display = "flex";
  miniOverlay.setAttribute("aria-hidden", "false");
}
function closeMini() {
  miniOverlay.style.display = "none";
  miniOverlay.setAttribute("aria-hidden", "true");
}

/* Add-to-home overlay */
function openHomeOverlay() {
  const ua = navigator.userAgent || "";
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  const isAndroid = /Android/i.test(ua);

  const shareSVG = `
    <svg class="share-icon" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 3v10" fill="none" stroke="black" stroke-width="2" stroke-linecap="round"/>
      <path d="M8.5 6.5 12 3l3.5 3.5" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M6 10v10h12V10" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  `;

  if (isIOS) {
    homeHow.textContent = "ios safari";
    homeSteps.innerHTML = `
      <div class="home-step">1) tap share ${shareSVG}</div>
      <div class="home-step">2) scroll → “add to home screen”</div>
      <div class="home-step">3) tap “add”</div>
    `;
  } else if (isAndroid) {
    homeHow.textContent = "android chrome";
    homeSteps.innerHTML = `
      <div class="home-step">1) tap the ⋮ menu</div>
      <div class="home-step">2) “add to home screen” (or “install app”)</div>
      <div class="home-step">3) confirm</div>
    `;
  } else {
    homeHow.textContent = "mobile";
    homeSteps.innerHTML = `<div class="home-step">open this page on your phone to add it to your home screen.</div>`;
  }

  homeOverlay.style.display = "flex";
  homeOverlay.setAttribute("aria-hidden", "false");
}

// close when clicking outside panels
cheatOverlay.addEventListener("pointerdown", (e) => { if (e.target === cheatOverlay) closeAllOverlays(); });
vaultOverlay.addEventListener("pointerdown", (e) => { if (e.target === vaultOverlay) closeAllOverlays(); });
miniOverlay.addEventListener("pointerdown", (e) => { if (e.target === miniOverlay) closeMini(); });
homeOverlay.addEventListener("pointerdown", (e) => { if (e.target === homeOverlay) closeAllOverlays(); });

// ===== shared action runner =====
function runActionByKey(keyRaw) {
  const key = (keyRaw || "").toLowerCase().trim();
  const action = actions[key];
  // ===== STRAIGHT REDIRECT (no play screen) =====
if (action.redirect && action.useGate === false) {
  const sameTab = action.sameTab !== false;

  if (sameTab) {
    window.location.href = action.redirect;
  } else {
    window.open(action.redirect, "_blank");
  }
  return;
}

  if (!action) return;

  passwordInput.disabled = true;
  closeAllOverlays();

  currentAction = action;

  // fade out password screen (same as videos)
  passwordScreen.style.opacity = 0;
  setTimeout(() => (passwordScreen.style.display = "none"), 400);

  // show experience page for ALL actions
  contentPage.style.display = "block";
  backButton.classList.add("show");

  // for redirects, we don't need the video UI
  videoWrapper.style.display = "none";
  videoWrapper.style.opacity = 0;
  videoWrapper.classList.remove("mobile-fill");

  playButton.classList.add("show");
  playButton.onclick = () => {
    playButton.classList.remove("show");

    // === REDIRECT ACTION ===
    if (currentAction.redirect) {
      const sameTab = currentAction.sameTab !== false;

      if (sameTab) {
        // same-tab navigation AFTER play
        window.location.href = currentAction.redirect;
      } else {
        // new tab, then return to password UI
        window.open(currentAction.redirect, "_blank");
        resetToPassword();
      }
      return;
    }

    // === VIDEO ACTION (existing behavior) ===
    videoWrapper.style.display = "block";
    videoWrapper.style.opacity = 0;

    if (currentAction.mobileFill) videoWrapper.classList.add("mobile-fill");
    else videoWrapper.classList.remove("mobile-fill");

    video.src = currentAction.src + "?v=" + Date.now();
    video.currentTime = 0;

    requestAnimationFrame(() => {
      videoWrapper.style.opacity = 1;
      video.play().catch(() => {});
    });

    endedListener = resetToPassword;
    video.addEventListener("ended", endedListener, { once: true });
  };
}


// ===== vault render (clickable) =====
function renderVault() {
  const unlockables = ["gambosi", "wasted", "heavychest"];
  const unlockedNow = unlockables.filter(c => unlocked.has(c));

  if (unlockedNow.length === 0) {
    vaultSub.textContent = "nothing unlocked";
    vaultList.textContent = "—";
    return;
  }

  vaultSub.textContent = "unlocked passcodes:";
  vaultList.innerHTML = "";

  for (const code of unlockedNow) {
    const btn = document.createElement("button");
    btn.className = "vault-item";
    btn.type = "button";
    btn.textContent = code;
    btn.addEventListener("click", () => runActionByKey(code));
    vaultList.appendChild(btn);
  }
}

// ===== password flow =====
function resetToPassword() {
  if (endedListener) video.removeEventListener("ended", endedListener);
  video.pause();
  video.removeAttribute("src");
  video.load();

  backButton.classList.remove("show");

  contentPage.style.display = "none";
  passwordScreen.style.display = "flex";
  passwordScreen.style.opacity = 1;

  videoWrapper.style.display = "none";
  videoWrapper.style.opacity = 0;
  videoWrapper.classList.remove("mobile-fill");

  playButton.classList.remove("show");
  playButton.onclick = null;

  passwordInput.disabled = false;
  passwordInput.value = "";

  hasWrongAttempt = false;
  closeAllOverlays();
  if (portalHint) portalHint.textContent = "hint: ? opens the code console";

  setButtonsForInputState();
  passwordInput.focus();
}

/* BFCache restore */
function hardResetPasswordUI() {
  if (endedListener) video.removeEventListener("ended", endedListener);

  video.pause();
  video.removeAttribute("src");
  video.load();

  currentAction = null;
  endedListener = null;

  contentPage.style.display = "none";
  passwordScreen.style.display = "flex";
  passwordScreen.style.opacity = 1;

  videoWrapper.style.display = "none";
  videoWrapper.style.opacity = 0;
  videoWrapper.classList.remove("mobile-fill");

  playButton.classList.remove("show");
  playButton.onclick = null;
  backButton.classList.remove("show");

  passwordInput.disabled = false;
  passwordInput.value = "";
  passwordInput.setAttribute("value", "");

  hasWrongAttempt = false;
  closeAllOverlays();

  setButtonsForInputState();
  requestAnimationFrame(() => passwordInput.focus());
}

window.addEventListener("pageshow", () => hardResetPasswordUI());
window.addEventListener("pagehide", () => { passwordInput.disabled = false; });

backButton.onclick = resetToPassword;

function setButtonsForInputState() {
  const hasText = passwordInput.value.length > 0;

  if (hasText && !enterLock) enterButton.classList.add("show");
  else enterButton.classList.remove("show");

  // Show cheat "?" ONLY after first wrong attempt and only when input is empty
  const cheatShouldShow = !hasText && !enterLock && hasWrongAttempt;

  if (hintHelp) {
    if (cheatShouldShow) hintHelp.classList.add("show");
    else hintHelp.classList.remove("show");
  }
}

if (hintHelp) {
  hintHelp.addEventListener("pointerdown", (e) => {
    if (!hintHelp.classList.contains("show")) return;
    e.preventDefault();
    SFX.unlockNow();
    try { passwordInput.blur(); } catch {}
    openCheatOverlay();
  });

  hintHelp.addEventListener("click", (e) => {
    if (!hintHelp.classList.contains("show")) return;
    e.preventDefault();
    try { passwordInput.blur(); } catch {}
    openCheatOverlay();
  });
}


// ===== enter flash ("nope") =====
let enterFlashTimer = null;
let enterLock = false;

function flashNope(ms = 520) {
  clearTimeout(enterFlashTimer);
  enterLock = true;

  enterButton.textContent = "nope";
  enterButton.classList.add("show");
  enterButton.classList.add("flash");

  enterFlashTimer = setTimeout(() => {
    enterButton.classList.remove("flash");
    enterButton.textContent = "enter ↵";
    enterLock = false;
    setButtonsForInputState();
  }, ms);
}
function shouldPlayCorrectForAction(action) {
  return !!action; // always allow; navigation happens after Play now
}


function tryPassword() {
  const key = passwordInput.value.toLowerCase().trim();
  const action = actions[key];

  if (!action) {
  SFX.play("password");
  hasWrongAttempt = true;
  passwordInput.value = "";
  flashNope(520);

  if (portalHint) portalHint.textContent = "hint: ? opens the code console";
  return;
}


  // only play "correct" if we won't immediately navigate away in same tab
  if (shouldPlayCorrectForAction(action)) SFX.play("correct");

  runActionByKey(key);
}

passwordInput.addEventListener("input", () => { if (!enterLock) setButtonsForInputState(); });
passwordInput.addEventListener("keyup", () => { if (!enterLock) setButtonsForInputState(); });
passwordInput.addEventListener("change", () => { if (!enterLock) setButtonsForInputState(); });
passwordInput.addEventListener("focus", () => { if (!enterLock) setButtonsForInputState(); });

/* SUBMIT: only submits */
passwordForm.addEventListener("submit", (e) => {
  e.preventDefault();
  if (passwordInput.disabled) return;
  if (passwordInput.value.trim().length === 0) return;
  tryPassword();
});

/* Enter key works */
passwordInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    e.preventDefault();
    if (!passwordInput.disabled && passwordInput.value.trim().length > 0) tryPassword();
  }
});

/* iOS: make tapping ENTER always submit before blur */
enterButton.addEventListener("pointerdown", (e) => {
  if (passwordInput.disabled) return;
  if (passwordInput.value.trim().length === 0) return;
  e.preventDefault();
  e.stopPropagation();
  SFX.unlockNow(); // keep within gesture
  tryPassword();
});

passwordScreen.addEventListener("pointerdown", (e) => {
  if (
    e.target === passwordInput ||
    e.target === enterButton ||
    e.target === hintHelp ||
    e.target === addHomeBtn
  ) return;

  if (!passwordInput.disabled && passwordInput.value.trim().length > 0) {
    tryPassword();
  }
});


// ===== navigation =====
cheatToVault.addEventListener("click", () => {
  cheatOverlay.style.display = "none";
  cheatOverlay.setAttribute("aria-hidden", "true");
  openVaultOverlay();
});

cheatClose.addEventListener("click", () => closeAllOverlays());

cheatInfo.addEventListener("click", () => openMini());
miniClose.addEventListener("click", () => closeMini());

vaultBack.addEventListener("click", () => {
  vaultOverlay.style.display = "none";
  vaultOverlay.setAttribute("aria-hidden", "true");
  openCheatOverlay();
});

vaultClose.addEventListener("click", () => closeAllOverlays());

// add-to-home wiring
addHomeBtn.addEventListener("click", () => openHomeOverlay());
homeClose.addEventListener("click", () => closeAllOverlays());

// ===== cheat entry mechanics =====
let cheatTokens = [];

function renderCheatSequence() {
  cheatSequenceEl.textContent = cheatTokens.join(" ");
}

function pushCheatToken(tok) {
  cheatTokens.push(tok);
  if (cheatTokens.length > 16) cheatTokens.shift();
  renderCheatSequence();
}

function clearCheat() {
  cheatTokens = [];
  renderCheatSequence();
}

function submitCheat() {
  const seq = cheatTokens.join(" ").trim();
  const unlockList = cheatUnlocks[seq];

  if (!unlockList || unlockList.length === 0) {
    clearCheat();
    SFX.play("password"); // wrong cheatcode => password.mp3
    showUnlockFlash("nope");
    return;
  }

  // correct cheatcode (even if already unlocked) => correct.mp3
  SFX.play("correct");

  const beforeSize = unlocked.size;

  for (const code of unlockList) {
    if (code === "gambosi" || code === "wasted" || code === "heavychest") unlocked.add(code);
  }
  saveUnlockedSet(unlocked);

  clearCheat();

  if (unlocked.size > beforeSize) showUnlockFlash("unlocked");
  else showUnlockFlash("already unlocked");
}

cheatClear.addEventListener("click", () => clearCheat());
cheatSubmit.addEventListener("click", () => submitCheat());

// tap tokens
cheatOverlay.addEventListener("click", (e) => {
  const btn = e.target.closest(".cheat-btn");
  if (!btn) return;
  pushCheatToken(btn.dataset.token);
});

// keyboard support: arrows + a + b + enter/backspace/escape
document.addEventListener("keydown", (e) => {
  if (miniOverlay.style.display === "flex") {
    if (e.key === "Escape") { e.preventDefault(); closeMini(); }
    return;
  }

  if (cheatOverlay.style.display !== "flex") return;

  if (e.key === "Escape") {
    e.preventDefault();
    closeAllOverlays();
    return;
  }

  if (e.key === "Backspace") {
    e.preventDefault();
    cheatTokens.pop();
    renderCheatSequence();
    return;
  }

  if (e.key === "Enter") {
    e.preventDefault();
    submitCheat();
    return;
  }

  let tok = null;
  if (e.key === "ArrowUp") tok = "U";
  else if (e.key === "ArrowDown") tok = "D";
  else if (e.key === "ArrowLeft") tok = "L";
  else if (e.key === "ArrowRight") tok = "R";
  else if (e.key.toLowerCase() === "a") tok = "A";
  else if (e.key.toLowerCase() === "b") tok = "B";

  if (tok) {
    e.preventDefault();
    pushCheatToken(tok);
  }
});

document.addEventListener("contextmenu", e => e.preventDefault());

// init
setButtonsForInputState();
</script>

</body>
</html>